<!DOCTYPE html>
<html lang="en">

<body>

    <div>Custom Form</div>
    <form id="theForm">
        <p>
            <label for="fName">First Name:</label>
            <input id="fName" name="fName" value="Some First Name" type="text" />
        </p>
        <p>
            <label for="lName">Last Name:</label>
            <input id="lName" name="lName"  value="Some Last Name" type="text" />
        </p>
        <p>
            <label for="email">Email:</label>
            <input id="email" value="Some email" name="email" type="text" />
        </p>
<!--        <button>Send Me!</button>-->
    </form>

<input type="button" value="Start Chat" onclick="startChat();"/><br/><br/><br/>
<input type="button" value="Clear Chat Session" onclick="clearSession();"/><br/>
<input type="button" value="test" onclick="test();"/><br/>

<p id="message">Agent is available</p>
<button onclick="checkAgentAvailability()">Проверить статус агента</button>

<!--
    Snipped Code from Embedded Service Deployment
-->

<style type='text/css'>
    .embeddedServiceHelpButton .helpButton .uiButton {
        background-color: #c8102e;
        font-family: "Source Sans Pro", sans-serif;
    }
    .embeddedServiceHelpButton .helpButton .uiButton:focus {
        outline: 1px solid #c8102e;
    }
</style>

<script type='text/javascript' src='https://service.force.com/embeddedservice/5.0/esw.min.js'></script>
<script type='text/javascript'>
    var initESW = function(gslbBaseURL) {
        embedded_svc.settings.displayHelpButton = false; //Or false
        embedded_svc.settings.language = ''; //For example, enter 'en' or 'en-US'

        //embedded_svc.settings.defaultMinimizedText = '...'; //(Defaults to Chat with an Expert)
        //embedded_svc.settings.disabledMinimizedText = '...'; //(Defaults to Agent Offline)

        //embedded_svc.settings.loadingText = ''; //(Defaults to Loading)
        //embedded_svc.settings.storageDomain = 'yourdomain.com'; //(Sets the domain for your deployment so that visitors can navigate subdomains during a chat session)

        // Settings for Chat
        //embedded_svc.settings.directToButtonRouting = function(prechatFormData) {
        // Dynamically changes the button ID based on what the visitor enters in the pre-chat form.
        // Returns a valid button ID.
        //};
        //embedded_svc.settings.prepopulatedPrechatFields = {}; //Sets the auto-population of pre-chat form fields
        //embedded_svc.settings.fallbackRouting = []; //An array of button IDs, user IDs, or userId_buttonId
        //embedded_svc.settings.offlineSupportMinimizedText = '...'; //(Defaults to Contact Us)


        embedded_svc.addEventHandler("onChatRequestSuccess", function(data) {
            console.log("onChatRequestSuccess event was fired.  liveAgentSessionKey was " + data.liveAgentSessionKey);
        });

        embedded_svc.addEventHandler("onChatEstablished", function(data) {
            var chatKey = data.liveAgentSessionKey;
            console.log("liveAgentSessionKey was " + chatKey);
        });


        embedded_svc.addEventHandler("onAvailability", function(data) {
            console.log("onAvailability event was fired. Agent availability status is " + data.isAgentAvailable ? "online": "offline");
        });


        embedded_svc.settings.enabledFeatures = ['LiveAgent'];
        embedded_svc.settings.entryFeature = 'LiveAgent';

        embedded_svc.init(
            'https://tipico--wordpress.sandbox.my.salesforce.com',
            'https://tipico--wordpress.sandbox.my.salesforce-sites.com/chat',
            gslbBaseURL,
            '00DPw000006X0HC',
            'testWP',
            {
                baseLiveAgentContentURL: 'https://c.la12s-core1.sfdc-cehfhs.salesforceliveagent.com/content',
                deploymentId: '572Pw000004yHRt',
                buttonId: '573Pw000002FmXp',
                baseLiveAgentURL: 'https://d.la12s-core1.sfdc-cehfhs.salesforceliveagent.com/chat',
                eswLiveAgentDevName: 'testWP',
                isOfflineSupportEnabled: false
            }
        );
    };

    if (!window.embedded_svc) {
        var s = document.createElement('script');
        s.setAttribute('src', 'https://tipico--wordpress.sandbox.my.salesforce.com/embeddedservice/5.0/esw.min.js');
        s.onload = function() {
            initESW(null);
        };
        document.body.appendChild(s);
    } else {
        initESW('https://service.force.com');
    }
</script>

<script>
    function startChat() {

        console.log( 'Inside Start Chat' );

        const fName = document.getElementById("fName");
        console.log('fName ' + fName.value);
        const lName = document.getElementById("lName");
        console.log('fName ' + lName.value);
        const emailVar = document.getElementById("email");
        console.log('fName ' + emailVar.value);

        let arr = [
            {
                "label": "First Name",
                "value": fName.value,
                "transcriptFields": ["FirstName__c"]
            }, {
                "label": "Last Name",
                "value": lName.value,
                "transcriptFields": ["LastName__c"]
            }, {
                "label": "Email",
                "value": emailVar.value,
                "transcriptFields": ["Email__c"]
            }
        ];

        console.log(arr);


        embedded_svc.liveAgentAPI.startChat({
            directToAgentRouting: {
                buttonId: "573Pw000002FmXp",
                fallback: true
            },
            extraPrechatFormDetails: arr
        });

        //
        // embedded_svc.liveAgentAPI.startChat({
        //     directToAgentRouting: {
        //         buttonId: "573Pw000002FmXp",
        //         fallback: true
        //     },
        //     extraPrechatFormDetails: [
        //         {
        //             "label": "First Name",
        //             "value": "Jonh2",
        //             "transcriptFields": ["FirstName__c"]
        //         }, {
        //             "label": "Last Name",
        //             "value": "Doe2",
        //             "transcriptFields": ["LastName__c"]
        //         }, {
        //             "label": "Email",
        //             "value": "Doe2@gmail.com",
        //             "transcriptFields": ["Email__c"]
        //         }
        //     ]
        // });
        //



        console.log( 'end Start Chat' );

    }

    function clearSession() {
        console.log( 'Inside Start Chat' );
        embedded_svc.liveAgentAPI.clearSession();

    }

    function test() {
        console.log( 'test' );

        const fName = document.getElementById("fName");
        console.log('fName ' + fName.value);
        const lName = document.getElementById("lName");
        console.log('fName ' + lName.value);
        const emailVar = document.getElementById("email");
        console.log('fName ' + emailVar.value);

        let arr = [
            {
                "label": "First Name",
                "value": fName.value,
                "transcriptFields": ["FirstName__c"]
            }, {
                "label": "Last Name",
                "value": lName.value,
                "transcriptFields": ["LastName__c"]
            }, {
                "label": "Email",
                "value": emailVar.value,
                "transcriptFields": ["Email__c"]
            }
        ];

        console.log(arr);
    }

/*
    function checkAgentAvailability() {
        embedded_svc.getAgentAvailability('573Pw000002FmXp', function (result) {

            var messageElement = document.getElementById("message");
            if (result.isAvailable) {
                messageElement.innerHTML = "Agent is available";
            } else {
                messageElement.innerHTML = "Agent is available";
            }
        });
    }

*/
    function checkAgentAvailability() {
        const elementEnabled = document.getElementsByClassName('uiButton helpButtonEnabled');
        const elementDisabled = document.getElementsByClassName('uiButton helpButtonDisabled');

        var messageElement = document.getElementById("message");

        if(elementEnabled && elementEnabled.length > 0) {
            messageElement.innerHTML = "Agent is available";
            console.log("Agent is available");
        }
        if(elementDisabled && elementDisabled.length > 0) {
            messageElement.innerHTML = "Agent is offline";
            console.log("Agent is available");

        }
    }
</script>
</body>
</html>
